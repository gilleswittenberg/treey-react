(window.webpackJsonp=window.webpackJsonp||[]).push([[0],[,,,,,,,function(e,t,n){e.exports=n(21)},,,,,,,function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){},function(e,t,n){"use strict";n.r(t);var r,a=n(1),u=n.n(a),c=n(6),o=n.n(c),s=n(4),i=n(0),l=n.n(i),p=n(2);!function(e){e[e.Create=0]="Create",e[e.IdentityAdd=1]="IdentityAdd",e[e.IdentityRemove=2]="IdentityRemove",e[e.Burn=3]="Burn",e[e.SchemaSet=4]="SchemaSet",e[e.DataSet=5]="DataSet",e[e.RelationAdd=6]="RelationAdd",e[e.RelationRemove=7]="RelationRemove",e[e.Prune=8]="Prune"}(r||(r={}));var f,d=function(e,t){var n={type:e,datetime:new Date},a=function(e,t){if(null==t)return null;switch(e){case r.Create:return null;case r.IdentityAdd:case r.IdentityRemove:return null!=t.id?{id:t.id}:null;case r.Burn:return null;case r.SchemaSet:return null!=t.schema?{schema:t.schema}:null;case r.DataSet:return null!=t.data?{data:t.data}:null;case r.RelationAdd:case r.RelationRemove:return null!=t.id?{id:t.id,index:t.index}:null;case r.Prune:return null!=t.state?{state:t.state}:null}return null}(e,t);return null!=a&&(n.payload=a),n},v=n(3),m=function(e){return Array.isArray(e)?e:[e]},x=function(e,t){if(null==e&&t.type!==r.Create)throw new Error("Item can not be null");if(null!=e&&t.type===r.Create)throw new Error("First ItemEvent should be Create");if(null!=e&&e.events[e.events.length-1].type===r.Burn)throw new Error("Can not add additional event after Burn event");return{events:(null!=e?e.events:[]).concat(t),state:function(e,t){switch(t.type){case r.Create:return{};case r.IdentityAdd:var n=t.payload?t.payload.id:null;if(null==n)return e;var a=e&&e.ids?e.ids.concat(n):[n];return Object(v.a)({},e,{ids:a});case r.IdentityRemove:var u=t.payload?t.payload.id:null;if(null==u)return e;var c=(e&&e.ids||[]).filter(function(e){return e.protocol!==u.protocol&&e.name!==u.name});return Object(v.a)({},e,{ids:c});case r.Burn:return e;case r.SchemaSet:var o=t.payload?t.payload.schema:null;return null==o?e:Object(v.a)({},e,{schema:o});case r.DataSet:var s=t.payload?t.payload.data:null;return Object(v.a)({},e,{data:s});case r.RelationAdd:var i=t.payload?t.payload.id:null;if(null==i)return e;var l=t.payload&&t.payload.index,p=e&&null!=e.relations?e.relations:[],f=null!=l&&p.length>l?p.splice(l,0,i):p.concat(i);return Object(v.a)({},e,{relations:f});case r.RelationRemove:var d=t.payload?t.payload.id:null;if(null==d)return e;var m=(e&&e.relations||[]).filter(function(e){return e.protocol!==d.protocol&&e.name!==d.name});return Object(v.a)({},e,{ids:m});case r.Prune:return e}return{}}(null!=e?e.state:{},t)||{}}},b=function(e,t){return m(t).reduce(x,e)},w=function(e){var t=m(e).reduce(x,null);if(null==t)throw new Error("Can not create item without events");return t},h=function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){window.indexedDB||t("IndexedDB not supported");var n=window.indexedDB.open("Treey",1);n.onerror=function(e){console.error("request.onerror",e),t(e)},n.onsuccess=function(n){var r=n.target.result;r.onerror=function(e){console.error("db.onerror",e),t(e)},e(r)},n.onupgradeneeded=function(e){e.oldVersion<1&&e.target.result.createObjectStore("items",{keyPath:"id"})}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}();Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h();case 2:f=e.sent;case 3:case"end":return e.stop()}},e)}))();var y=function(){var e=Object(p.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=f.transaction("items","readwrite").objectStore("items").get(t);r.onerror=function(e){console.error(e),n()},r.onsuccess=function(t){if(null==t.target)return n();var r=t.target.result;if(null==r)return n();e(r)}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),j=function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){var n=f.transaction("items","readwrite").objectStore("items").getAll();n.onerror=function(e){console.error(e),t()},n.onsuccess=function(n){if(null==n.target)return t();var r=n.target.result;e(r)}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),k={addItem:function(){var e=Object(p.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=f.transaction("items","readwrite").objectStore("items").add(t);r.onerror=function(e){console.error(e),n()},r.onsuccess=function(n){e(t)}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),getItem:y,getItems:j,putItem:function(){var e=Object(p.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,n){var r=f.transaction("items","readwrite").objectStore("items").put(t);r.onerror=function(e){console.error(e),n()},r.onsuccess=function(n){console.log(n),e(t)}}));case 1:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),clear:function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e,t){var n=f.transaction("items","readwrite").objectStore("items").clear();n.onerror=function(e){console.error(e),t()},n.onsuccess=function(){e([])}}));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},O={},E=function(){var e=Object(p.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,O[n]=t,e.abrupt("return",t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),g=function(){var e=Object(p.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=O[t],e.abrupt("return",null!=n?n:void 0);case 2:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),I=function(){var e=Object(p.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.id,O[n]=t,e.abrupt("return",t);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),R=function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Object.values(O));case 1:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return Object.keys(O).forEach(function(e){return delete O[e]}),e.next=3,R();case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),D={create:E,read:g,update:I,index:R,clear:S},A=function(){return window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295},C=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*A()|0;return("x"===e?t:3&t|8).toString(16)})},B=function(){var e=Object(p.a)(l.a.mark(function e(t){var n,a,u,c,o,s,i=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]&&i[1],a=C(),u={protocol:"self",name:a},c=d(r.IdentityAdd,{id:u}),o=b(t,[c]),s=Object(v.a)({id:a,isRoot:n},o),e.next=9,k.addItem(s);case 9:e.t0=e.sent,e.next=15;break;case 12:return e.next=14,D.create(s);case 14:e.t0=e.sent;case 15:return e.abrupt("return",e.t0);case 16:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),P=function(){var e=Object(p.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(n=t.name)){e.next=3;break}return e.abrupt("return",void 0);case 3:return e.next=6,k.getItem(n);case 6:e.t0=e.sent,e.next=12;break;case 9:return e.next=11,D.read(n);case 11:e.t0=e.sent;case 12:return e.abrupt("return",e.t0);case 13:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),N=function(){var e=Object(p.a)(l.a.mark(function e(t,n){var r,a,u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,P(t);case 2:if(null!=(r=e.sent)){e.next=5;break}return e.abrupt("return",void 0);case 5:return a=b(r,m(n)),u=Object(v.a)({id:r.id,isRoot:r.isRoot},a),e.next=10,k.putItem(u);case 10:e.t0=e.sent,e.next=16;break;case 13:return e.next=15,D.update(u);case 15:e.t0=e.sent;case 16:return e.abrupt("return",e.t0);case 17:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),T=function(){var e=Object(p.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=d(r.Burn),e.next=3,N(t,[n]);case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),F={create:B,read:P,update:N,del:T,index:function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,k.getItems();case 3:e.t0=e.sent,e.next=9;break;case 6:return e.next=8,D.index();case 8:e.t0=e.sent;case 9:return e.abrupt("return",e.t0);case 10:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),clear:function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,k.clear();case 3:e.next=7;break;case 5:return e.next=7,D.clear();case 7:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},L={create:function(){var e=Object(p.a)(l.a.mark(function e(){var t,n,a,u=arguments;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=u.length>0&&void 0!==u[0]&&u[0],n=d(r.Create),a=w([n]),e.next=5,F.create(a,t);case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),read:function(){var e=Object(p.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.read(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),update:function(){var e=Object(p.a)(l.a.mark(function e(t,n){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.update(t,m(n));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),del:function(){var e=Object(p.a)(l.a.mark(function e(t){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,F.del(t);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}(),index:function(){var e=Object(p.a)(l.a.mark(function e(){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.t0=m,e.next=3,F.index();case 3:return e.t1=e.sent,e.abrupt("return",(0,e.t0)(e.t1));case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()},_=function e(t,n){var r=(t.state.relations||[]).map(function(e){return function(e,t){return t.find(function(t){var n=t.state.ids&&t.state.ids[0];return null!=n&&n.name===e.name})}(e,n)}).filter(function(e){return void 0!==e}).filter(function(e){return void 0!==e}).map(function(t){return e(t,n)});return Object(v.a)({},t,{relations:r})},U=function(){var e=Object(p.a)(l.a.mark(function e(){var t,n,r;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.index();case 2:if(t=e.sent,null==(n=t.find(function(e){return!0===e.isRoot}))){e.next=8;break}e.t0=n,e.next=11;break;case 8:return e.next=10,L.create(!0);case 10:e.t0=e.sent;case 11:return r=e.t0,e.abrupt("return",_(r,t));case 13:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),W=function(){var e=Object(p.a)(l.a.mark(function e(t,n){var a,u,c,o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.create();case 2:if(a=e.sent,u=a.state.ids&&a.state.ids[0]){e.next=8;break}return e.next=7,U();case 7:return e.abrupt("return",e.sent);case 8:return c=d(r.DataSet,{data:t}),e.next=11,L.update(u,c);case 11:return o=d(r.RelationAdd,{id:u}),e.next=14,L.update(n,o);case 14:return e.next=16,U();case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),J=function(){var e=Object(p.a)(l.a.mark(function e(t,n){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a=d(r.DataSet,{data:n}),e.next=3,L.update(t,a);case 3:return e.next=5,U();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),V=function(){var e=Object(p.a)(l.a.mark(function e(t,n,a){var u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return u=d(r.RelationRemove,{id:t,index:a}),e.next=3,L.update(n,u);case 3:return e.next=5,U();case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),q=function(){var e=Object(p.a)(l.a.mark(function e(t,n,a,u,c){var o,s;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=d(r.RelationRemove,{id:t,index:a}),e.next=3,L.update(n,o);case 3:return s=d(r.RelationAdd,{id:t,index:c}),e.next=6,L.update(u,s);case 6:return e.next=8,U();case 8:return e.abrupt("return",e.sent);case 9:case"end":return e.stop()}},e)}));return function(t,n,r,a,u){return e.apply(this,arguments)}}(),H=function(){var e=Object(a.useState)(),t=Object(s.a)(e,2),n=t[0],r=t[1];Object(a.useEffect)(function(){Object(p.a)(l.a.mark(function e(){var t;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:t=e.sent,r(t);case 4:case"end":return e.stop()}},e)}))()},[]);var u={createAndAdd:function(){var e=Object(p.a)(l.a.mark(function e(t,n){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,W(t,n);case 2:a=e.sent,r(a);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),update:function(){var e=Object(p.a)(l.a.mark(function e(t,n){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,J(t,n);case 2:a=e.sent,r(a);case 4:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}(),remove:function(){var e=Object(p.a)(l.a.mark(function e(t,n,a){var u;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V(n,t,a);case 2:u=e.sent,r(u);case 4:case"end":return e.stop()}},e)}));return function(t,n,r){return e.apply(this,arguments)}}(),move:function(){var e=Object(p.a)(l.a.mark(function e(t,n,a,u,c){var o;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,q(t,n,a,u,c);case 2:o=e.sent,r(o);case 4:case"end":return e.stop()}},e)}));return function(t,n,r,a,u){return e.apply(this,arguments)}}()};return[n,u]},$=(n(14),function(){return u.a.createElement("header",{className:"Header"},u.a.createElement("h1",null,u.a.createElement("img",{src:"/treey-react/images/logo_64x64.png",width:"32px",height:"32px",alt:"\u6728"})),u.a.createElement("h2",null,"treey"))}),z=function(e){Object(a.useEffect)(function(){var t=function(t){27===t.keyCode&&(t.preventDefault(),e())};return window.addEventListener("keydown",t),function(){return window.removeEventListener("keydown",t)}},[e])},G=(n(15),function(e){var t=e.type,n=e.onClick,r={backgroundImage:"ADD"===t?'url("'.concat("/treey-react",'/images/add_64x64.png")'):"EDIT"===t?'url("'.concat("/treey-react",'/images/submit_64x64.png")'):"DELETE"===t?'url("'.concat("/treey-react",'/images/remove_64x64.png")'):""};return u.a.createElement("button",{className:"Button",style:r,onClick:n,title:t},t)}),K=(n(16),function(e){var t=e.parentId,n=e.index,r=e.item,c=e.treey,o=r.state&&r.state.data,i=r.state.ids&&r.state.ids[0],f=Object(a.useState)(!1),d=Object(s.a)(f,2),v=d[0],m=d[1],x=Object(a.useState)(o),b=Object(s.a)(x,2),w=b[0],h=b[1],y=Object(a.useState)(!1),j=Object(s.a)(y,2),k=j[0],O=j[1],E=!v,g=v,I=i&&k,R=function(){var e=Object(p.a)(l.a.mark(function e(){var a;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(a=r.state.ids&&r.state.ids[0])){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,c.remove(a,t,n);case 5:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),S=function(){var e=Object(p.a)(l.a.mark(function e(t){var n;return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),null!=(n=r.state.ids&&r.state.ids[0])){e.next=4;break}return e.abrupt("return");case 4:return e.next=6,c.update(n,w);case 6:m(!1);case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return z(function(){return m(!1)}),u.a.createElement("div",{className:"Item"},E&&u.a.createElement("div",{className:"ItemBody"},u.a.createElement("span",{onClick:function(){return O(!k)}},o),u.a.createElement(G,{type:"EDIT",onClick:function(){return m(!0)}}),u.a.createElement(G,{type:"DELETE",onClick:R})),g&&u.a.createElement("form",{onSubmit:S},u.a.createElement("input",{type:"text",onChange:function(e){var t=e.target.value;h(t)},value:w,autoFocus:!0}),u.a.createElement(G,{type:"EDIT"})),i&&I&&u.a.createElement(Q,{parentId:i,items:r.relations,treey:c}))}),M=(n(17),function(e){var t=e.parentId,n=e.treey,r=Object(a.useState)(!1),c=Object(s.a)(r,2),o=c[0],i=c[1],f=Object(a.useState)(""),d=Object(s.a)(f,2),v=d[0],m=d[1],x=!1===o,b=!x,w=function(){var e=Object(p.a)(l.a.mark(function e(r){return l.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r.preventDefault(),e.next=3,n.createAndAdd(v,t);case 3:i(!1),m("");case 5:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}();return z(function(){return i(!1)}),u.a.createElement("div",{className:"FormAdd"},x&&u.a.createElement(G,{onClick:function(){return i(!0)},type:"ADD"}),b&&u.a.createElement("form",{onSubmit:w},u.a.createElement("input",{type:"text",onChange:function(e){var t=e.target.value;m(t)},value:v,autoFocus:!0}),u.a.createElement(G,{type:"ADD"})))}),Q=(n(18),function(e){var t=e.parentId,n=e.items,r=e.treey,a=n.length>0;return u.a.createElement("div",{className:"Items"},a&&u.a.createElement("ul",null,n.map(function(e,n){var a=e.state.ids&&e.state.ids[0].name;return u.a.createElement("li",{key:a},u.a.createElement(K,{parentId:t,index:n,item:e,treey:r}))})),u.a.createElement(M,{parentId:t,treey:r}))}),X=(n(19),function(){var e=H(),t=Object(s.a)(e,2),n=t[0],r=t[1],a=void 0===n,c=!a,o=n&&n.id,i=n&&n.relations,l=n&&n.state.ids&&n.state.ids[0];return u.a.createElement("div",{className:"App"},u.a.createElement($,null),u.a.createElement("main",null,a&&u.a.createElement("p",null,"is loading\u2026"),c&&u.a.createElement(u.a.Fragment,null,u.a.createElement("h1",{className:"RootItem"},u.a.createElement("span",null,"your Root UUID: "),o),u.a.createElement("div",{className:"ItemsWrap"},u.a.createElement(Q,{parentId:l,items:i,treey:r})))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));n(20);o.a.render(u.a.createElement(X,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}],[[7,1,2]]]);
//# sourceMappingURL=main.fca84e60.chunk.js.map